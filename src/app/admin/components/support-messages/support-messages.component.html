<div class="support-messages-container">
    <div class="header">
        <h1>Support Messages</h1>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label for="status">Status:</label>
            <select id="status" [(ngModel)]="status" (change)="onStatusChange()" class="form-control">
                <option [value]="undefined">All</option>
                <option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="sortBy">Sort By:</label>
            <select id="sortBy" [(ngModel)]="sortBy" (change)="onSortChange()" class="form-control">
                <option value="createdAt">Created</option>
                <option value="likes">Likes</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="sortOrder">Order:</label>
            <select id="sortOrder" [(ngModel)]="sortOrder" (change)="onSortChange()" class="form-control">
                <option value="DESC">Descending</option>
                <option value="ASC">Ascending</option>
            </select>
        </div>
    </div>

    <div class="table-wrapper" *ngIf="!loading">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Request ID</th>
                    <th>From</th>
                    <th>Email</th>
                    <th>Location</th>
                    <th>Type</th>
                    <th>Message</th>
                    <th>Status</th>
                    <th>Likes</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let msg of messages">
                    <td>{{ msg.id }}</td>
                    <td>{{ msg.requestId }}</td>
                    <td>{{ msg.fromName }}</td>
                    <td>{{ msg.email }}</td>
                    <td>{{ msg.location }}</td>
                    <td><span class="badge badge-info">{{ msg.type }}</span></td>
                    <td class="message-cell" [title]="msg.message">{{ truncateMessage(msg.message) }}</td>
                    <td>
                        <select 
                            [(ngModel)]="msg.status" 
                            (change)="changeMessageStatus(msg.id, msg.status)"
                            class="form-control form-control-sm status-select"
                            [class.status-approved]="msg.status === 'approved'"
                            [class.status-pending]="msg.status === 'pending_approval'"
                            [class.status-rejected]="msg.status === 'rejected'">
                            <option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
                        </select>
                    </td>
                    <td>{{ msg.likes }}</td>
                    <td>{{ msg.createdAt | date: 'short' }}</td>
                    <td class="actions">
                        <button 
                            (click)="deleteMessage(msg.id)"
                            class="btn btn-sm btn-danger">
                            Delete
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="loading" *ngIf="loading">
        <p>Loading...</p>
    </div>

    <div class="pagination">
        <button (click)="onPrevPage()" [disabled]="page === 1" class="btn">Previous</button>
        <span>Page {{ page }} of {{ totalPages }} (Total: {{ total }})</span>
        <button (click)="onNextPage()" [disabled]="page * limit >= total" class="btn">Next</button>
    </div>
</div>

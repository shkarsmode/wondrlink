<div class="toolbar">
    <div class="tabs">
        @for (t of statusTabs; track t.value) {
            <button
                class="tab"
                [class.active]="statusFilter() === t.value"
                (click)="setFilter(t.value)"
                type="button">
                {{ t.label }}
            </button>
        }
    </div>

    <div class="tools">
        <input
            class="search"
            type="search"
            placeholder="Search name, email, tags, note"
            (input)="onInput($event)"
            />

        <label class="limit">
            <span>Per page</span>
            <select (change)="setLimit(+$any($event.target).value)">
                <option [selected]="limit()===10" value="10">10</option>
                <option [selected]="limit()===20" value="20">20</option>
                <option [selected]="limit()===50" value="50">50</option>
            </select>
        </label>
    </div>
</div>

<div class="table-wrapper" [class.loading]="loading()">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Created</th>
                <th>User</th>
                <th>Place / Credit</th>
                <th>Tags</th>
                <th>Image</th>
                <th>Status</th>
                <th class="actions">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (filtered().length === 0 && !loading()) {
                <tr>
                    <td colspan="8" class="empty">No items</td>
                </tr>
            } @else {
                @for (v of filtered(); track v.id) {
                    <tr>
                        <td>#{{ v.id }}</td>
                        <td>
                            <div class="mono">{{ v.createdAt | date:'yyyy-MM-dd HH:mm' }}</div>
                        </td>

                        <td>
                            <div class="main">{{ v.firstName || '—' }}</div>
                            <div class="sub mono">{{ v.email || '—' }}</div>
                        </td>

                        <td>
                            <div class="main">{{ v.location || '—' }}</div>
                            <div class="sub">{{ v.creditTo || '—' }}</div>
                        </td>

                        <td>
                            <div class="chips">
                                @for (t of (v.what || []); track t) {
                                    <span class="chip blue">{{ t }}</span>
                                }
                                @for (t of (v.express || []); track t) {
                                    <span class="chip green">{{ t }}</span>
                                }
                            </div>
                            @if (v.note) {
                                <div class="note" [title]="v.note">{{ v.note }}</div>
                            }
                        </td>

                        <td class="img-col">
                            @if (v.img) {
                                <img class="thumb" [src]="v.img" alt="img" />
                                <button class="link" (click)="copyImg(v.img)" title="Copy URL" type="button">Copy</button>
                            } @else {
                                —
                            }
                        </td>

                        <td>
                            <span class="status" [class.pending]="v.status==='pending'"
                                              [class.approved]="v.status==='approved'"
                                              [class.rejected]="v.status==='rejected'">
                                {{ v.status }}
                            </span>
                        </td>

                        <td class="actions">
                            @for (a of statusActions; track a.value) {
                                <button
                                    class="btn sm"
                                    [class]="a.class"
                                    [disabled]="loading() || v.status===a.value"
                                    (click)="onStatusAction(v, a.value)"
                                    type="button">
                                    {{ a.label }}
                                </button>
                            }
                            @if (!userService.isModerator) {                           
                                <button
                                    class="btn sm ghost"
                                    [disabled]="loading()"
                                    (click)="onDelete(v)"
                                    type="button">
                                    Delete
                                </button>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    @if (loading()) {
        <div class="loader">Loading…</div>
    }
</div>

<div class="pager">
    <button class="btn" (click)="prevPage()" [disabled]="page()<=1 || loading()" type="button">Prev</button>
    <span class="mono">Page {{ page() }} / {{ totalPages() }}</span>
    <button class="btn" (click)="nextPage()" [disabled]="page()>=totalPages() || loading()" type="button">Next</button>
</div>
